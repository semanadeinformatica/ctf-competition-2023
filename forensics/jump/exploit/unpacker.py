from PIL import Image
from Crypto.PublicKey import RSA
from Crypto.Cipher import PKCS1_OAEP
import tarfile

with Image.open("jump_with_key.gif") as img:
    keypair = img.info["comment"]


with open("jump_with_key.gif", "rb") as f:
    data = f.read()
    with open("payload.tar.gz", "wb") as f2:
        f2.write(data[2821836:]) # Value obtained with binwalk


# Unpack tar.gz file
with tarfile.open("payload.tar.gz", "r:gz") as tar:
    tar.extractall()

# Decrypt message
with open("message.txt.enc", "rb") as f:
    encrypted_message = f.read()

keypair = RSA.import_key(keypair)
keypair = PKCS1_OAEP.new(keypair)

print(keypair.decrypt(encrypted_message).decode())

# Remove files
import os
os.remove("payload.tar.gz")
os.remove("message.txt.enc")

# Decrypt using: openssl rsautl -in message.txt.enc -inkey private_key.pem -decrypt
